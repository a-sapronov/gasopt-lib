# gasopt-lib

## Требования
Код работает с python3.7+. Необходимые пакеты указаны в requirements.txt (установятся сами при установке библиотеки gasopt-lib). Для установки необходим pip3 (sudo apt-get install python3-pip)

## Установка

1) Скачать библиотеку:  
git clone https://github.com/a-sapronov/gasopt-lib.git  
cd gasopt-lib  

2) установить virtualenv, если отсутствует, и создать виртуальное python-окружение  
pip3 install virtualenv  
export PATH=~/.local/bin/:$PATH  
virtualenv venv  
source venv/bin/activate  

3) установить библиотеку в это виртуальное окружение  
pip3 install -r requirements.txt .  

4) скачать файл с данными и моделями и распаковать его:  
wget ... ( ссылку можно получить по личному запросу на asapronov ав-ав hse.ru )  
tar xzf gasopt-models-and-data.tgz  
(распакуется в examples/models и examples/test_data)  

## Вызов функций библиотеки
Примеры вызова функций библиотек приведены в файлах forecast-example.py (прогнозирование потребления ПГ) и optimization-example.py (оптимизация потребления ПГ).

### Прогнозирование расхода газа
Для загрузки исторических данных, на основе которых нужно построить прогноз расхода газа, используется функция furn_forecast_data_process. Функция получает на вход путь к эксель файлу, в котором находится отчет по расходу газа с 10-минутной детализацией, и выводит pandas-dataframe с данными, подготовленными для прогнозирования. Прогноз строится с помощью функции furnace_forecast(gas_df, horizon, furn_id), у которой три аргумента - gas_df - pandas-dataframe с подготовленными для прогнозирования данными, horizon - горизонт прогнозирования в часах, furn_id - номер печи (1-4). На выход выдается pandas-dataframe с прогнозными значениями на следующие horizon часов по четырем моделям FFNN (нейронная сеть прямого распространения), RNN (рекуррентная нейронная сеть), SARIMAX (интегрированная авторегрессионная модель с сезонностью), ARCH (авторегрессионная модель с условной гетероскедастичностью) комбинированные с линейной экстраполяцией.

Аналогичным образом можно получить прогнозирование расхода газа на ЦЭС: tses_forecast_data_process() для предобработки данных и generator_forecast() для прогнозирования.

### Оптимизация расхода газа
Оптимизация газа производится исходя из параметров слябов, которые нужно нагреть в печи. Параметры слябов собираются в таблицу с полями:

| поле | что означает |
| --- | --- |
| length_s | длина сляба |
| width_s | ширина сляба |
| weight_s | вес сляба |
| slab_temp | температура посада |
| l_thick | толщина проката |
| dt_prev | временной промежуток между данным слябом и предыдущим (мин) |
| row | ряд печи в который будет посажен сляб |
| mark | марка стали |  

Марка стали может быть одной из 08пс, Ст3сп, SAE 1006, 20, Ст2пс, 09Г2С, 08Ю, S235JR, DD11, 10пс, Ст3пс, DX54D, Ст1пс, DD11-1, 10ХНДП, DX51D, 2, 07ГБЮ, 10, 08ЮР. Остальные марки должны быть переобозначены 'other'.

Предобработка данных производится функцией furn_optimization_data_process() из модуля data_load. Функция предобработки принимает на вход путь к CSV-файлу с таблицей слябов. На вывод функция подает pandas-dataframe с предобработанными данными. Для расчета рекомендованных значений настроек газа в зонах печи применяется функция furnace_optimization(slab_df, furn_id) из модуля furnace_interface. Она принимает на вход два аргумента: pandas-dataframe с предобработанными данными о слябах и номер печи (1-4), для которых нужно вычислить рекомендованные значения расхода. На выход выдается pandas-dataframe с рекомендуемыми значениями расхода газа для каждого сляба. Чтобы уменьшить влияние скорости печи на данный расчет, рекомендуемые значения выдаются в двух видах: усредненные по времени нахождения слябв в соответствующей зоне, и проинтегрированные по этому времени. Полный список полей dataframe с рекомедуемыми значениями расхода газа по зонам: agas_1, agas_2, agas_3, agas_4, agas_5, agas_6, agas_7l, agas_7r, agas_8l, agas_8r, igas_1, igas_2, igas_3, igas_4, igas_5, igas_6, igas_7l, igas_7r, igas_8l, igas_8r . Название полей имеет вид [ai]gas_Z, где a или i соответствует виду рекомендованного значения: a=averaged (усредненное), i=integrated (интегрированное), а Z - соответствует номеру зоны. Зоны 7 и 8 имеют парные значения l (left, левая) и r (right, правая).

